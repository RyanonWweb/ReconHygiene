---
import SiteLayout from '../../layouts/SiteLayout.astro';
import { getCollection, render } from 'astro:content';
import type { GetStaticPaths } from 'astro';

export const getStaticPaths = (async () => {
  const projects = await getCollection('projects', ({ data }) => !data.draft);
  return projects.map(p => ({ params: { slug: p.id.replace(/\.mdx?$/, '') }, props: { project: p } }));
}) satisfies GetStaticPaths;

const { project } = Astro.props;
const { title, date, summary, stack, outcome, tags } = project.data;
const { Content } = await render(project);
const formattedDate = new Date(date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
---

<SiteLayout title={title} description={summary}>
  <div class="page-header">
    <div class="container">
      <div class="breadcrumb"><a href="/">Home</a> / <a href="/projects">Projects</a> / {title}</div>
      <div class="tag-row">
        {stack.map(s => <span class="tag">{s}</span>)}
        {tags.map(t => <span class="tag">{t}</span>)}
      </div>
      <h1 class="page-title" style="font-size:2rem">{title}</h1>
      <p class="page-sub">{summary}</p>
      <time class="hunt-date" datetime={date.toISOString()}>{formattedDate}</time>
    </div>
  </div>
  <div class="container article-container">
    <article class="prose-dark"><Content /></article>
    <aside class="hunt-sidebar">
      <div class="sidebar-card glass">
        <h4 class="sidebar-title">Stack</h4>
        <div style="display:flex;flex-wrap:wrap;gap:0.4rem;margin-top:0.5rem">
          {stack.map(s => <span class="badge badge-cyan">{s}</span>)}
        </div>
      </div>
      {outcome && (
        <div class="sidebar-card glass">
          <h4 class="sidebar-title">Outcome</h4>
          <p style="font-size:0.85rem;color:var(--text-dim);margin:0.5rem 0 0">{outcome}</p>
        </div>
      )}
      <div class="sidebar-card glass">
        <h4 class="sidebar-title">Published</h4>
        <p style="font-size:0.82rem;color:var(--text-muted);margin:0.5rem 0 0;font-family:'JetBrains Mono',monospace">{formattedDate}</p>
      </div>
      <a href="/projects" class="btn btn-ghost" style="width:100%;justify-content:center">‚Üê All Projects</a>
    </aside>
  </div>
</SiteLayout>

<style>
  .page-header { border-bottom: 1px solid var(--border); background: var(--surface); padding: 3.5rem 0 2rem; }
  .breadcrumb { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.75rem; font-family: 'JetBrains Mono', monospace; }
  .breadcrumb a { color: var(--text-muted); }
  .breadcrumb a:hover { color: var(--cyan); }
  .tag-row { display: flex; flex-wrap: wrap; gap: 0.4rem; margin-bottom: 1rem; }
  .page-title { font-size: 2rem; margin: 0 0 0.75rem; }
  .page-sub { color: var(--text-muted); font-size: 0.95rem; margin: 0 0 0.75rem; max-width: 65ch; }
  .hunt-date { font-size: 0.8rem; color: var(--text-muted); font-family: 'JetBrains Mono', monospace; }
  .article-container { display: grid; grid-template-columns: 1fr 280px; gap: 3rem; padding-top: 3rem; padding-bottom: 4rem; align-items: start; }
  .hunt-sidebar { position: sticky; top: 80px; display: flex; flex-direction: column; gap: 1rem; }
  .sidebar-card { padding: 1.25rem; }
  .sidebar-title { font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-muted); margin: 0 0 0.5rem; }
  @media (max-width: 900px) { .article-container { grid-template-columns: 1fr; } .hunt-sidebar { position: static; } }
</style>
